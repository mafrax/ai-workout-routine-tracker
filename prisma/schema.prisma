generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                  BigInt           @id @default(autoincrement())
  createdAt           DateTime         @default(now()) @map("created_at")
  email               String?          @unique
  googleId            String?          @unique @map("google_id")
  lastLogin           DateTime?        @map("last_login")
  name                String?
  picture             String?
  provider            String?
  age                 Int?
  weight              Float?
  height              Float?
  fitnessLevel        String?          @map("fitness_level")
  goals               String?
  availableEquipment  String?          @map("available_equipment")
  bodyweightExercises String?          @map("bodyweight_exercises")
  dailyTasks           DailyTask[]
  telegramConfig       TelegramConfig?
  workoutPlans         WorkoutPlan[]
  workoutSessions      WorkoutSession[]
  fastingPresets       FastingPreset[]
  fastingSessions      FastingSession[]
  fastingEatingWindows FastingEatingWindow[]

  @@map("users")
}

model DailyTask {
  id          BigInt    @id @default(autoincrement())
  userId      BigInt    @map("user_id")
  title       String
  completed   Boolean   @default(false)
  createdAt   DateTime  @default(now()) @map("created_at")
  lastResetAt DateTime? @map("last_reset_at")
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("daily_tasks")
}

model TelegramConfig {
  id                   BigInt    @id @default(autoincrement())
  userId               BigInt    @unique @map("user_id")
  botToken             String?   @map("bot_token")
  chatId               String?   @map("chat_id")
  dailyTasksStartHour  Int       @default(9) @map("daily_tasks_start_hour")
  lastTaskReminderSent DateTime? @map("last_task_reminder_sent")
  createdAt            DateTime  @default(now()) @map("created_at")
  user                 User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("telegram_config")
}

model WorkoutPlan {
  id                  BigInt           @id @default(autoincrement())
  userId              BigInt           @map("user_id")
  name                String
  planDetails         String?          @map("plan_details")
  isActive            Boolean          @default(false) @map("is_active")
  isArchived          Boolean          @default(false) @map("is_archived")
  telegramPreviewHour Int?             @map("telegram_preview_hour")
  reminderTime        String?          @map("reminder_time")
  createdAt           DateTime         @default(now()) @map("created_at")
  description         String?
  daysPerWeek         Int?             @map("days_per_week")
  durationWeeks       Int?             @map("duration_weeks")
  difficultyLevel     String?          @map("difficulty_level")
  color               String?
  user                User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  workoutSessions     WorkoutSession[]
  workouts            Workout[]

  @@map("workout_plans")
}

model Workout {
  id              BigInt           @id @default(autoincrement())
  planId          BigInt           @map("plan_id")
  day             Int
  muscleGroup     String           @map("muscle_group")
  createdAt       DateTime         @default(now()) @map("created_at")
  exercises       Exercise[]
  workoutSessions WorkoutSession[]
  plan            WorkoutPlan      @relation(fields: [planId], references: [id], onDelete: Cascade)

  @@unique([planId, day])
  @@map("workouts")
}

model Exercise {
  id            BigInt   @id @default(autoincrement())
  workoutId     BigInt   @map("workout_id")
  orderIndex    Int      @map("order_index")
  exerciseTitle String   @map("exercise_title")
  numberOfReps  String   @map("number_of_reps")
  weight        Float?
  isBodyweight  Boolean  @default(false) @map("is_bodyweight")
  restTime      Int?     @map("rest_time")
  notes         String?
  createdAt     DateTime @default(now()) @map("created_at")
  workout       Workout  @relation(fields: [workoutId], references: [id], onDelete: Cascade)

  @@unique([workoutId, orderIndex])
  @@map("exercises")
}

model WorkoutSession {
  id              BigInt       @id @default(autoincrement())
  userId          BigInt       @map("user_id")
  planId          BigInt?      @map("plan_id")
  sessionDate     String       @map("session_date")
  durationMinutes Int?         @map("duration_minutes")
  completionRate  Float?       @map("completion_rate")
  notes           String?
  createdAt       DateTime     @default(now()) @map("created_at")
  workoutId       BigInt?      @map("workout_id")
  plan            WorkoutPlan? @relation(fields: [planId], references: [id])
  user            User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  workout         Workout?     @relation(fields: [workoutId], references: [id])

  @@map("workout_sessions")
}

model ConversationHistory {
  id        BigInt   @id @default(autoincrement())
  userId    BigInt   @map("user_id")
  message   String
  response  String
  timestamp DateTime @default(now())
  createdAt DateTime @default(now()) @map("created_at")

  @@map("conversation_history")
}

model FastingPreset {
  id              String   @id @default(uuid())
  userId          BigInt   @map("user_id")
  name            String
  durationMinutes Int      @map("duration_minutes")
  createdAt       DateTime @default(now()) @map("created_at")
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("fasting_presets")
}

model FastingSession {
  id                  String    @id @default(uuid())
  userId              BigInt    @map("user_id")
  startTime           DateTime  @map("start_time")
  endTime             DateTime? @map("end_time")
  goalMinutes         Int       @map("goal_minutes")
  presetName          String    @map("preset_name")
  stoppedEarly        Boolean   @map("stopped_early")
  eatingWindowMinutes Int       @map("eating_window_minutes")
  createdAt           DateTime  @default(now()) @map("created_at")
  user                User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("fasting_sessions")
}

model FastingEatingWindow {
  id                      String    @id @default(uuid())
  userId                  BigInt    @map("user_id")
  startTime               DateTime  @map("start_time")
  endTime                 DateTime? @map("end_time")
  expectedDurationMinutes Int       @map("expected_duration_minutes")
  nextFastDueTime         DateTime  @map("next_fast_due_time")
  createdAt               DateTime  @default(now()) @map("created_at")
  user                    User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("fasting_eating_windows")
}
